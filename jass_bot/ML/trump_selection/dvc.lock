schema: '2.0'
stages:
  swisslos_balancing:
    cmd: python swisslos_balancing.py
    deps:
    - path: data/2018_10_18_trump.csv
      hash: md5
      md5: 013ca90aae71ae624a1f8925ce1dd4d7
      size: 29435104
    - path: data/player_all_stat.json
      hash: md5
      md5: 449bda193ce902fff9af5874b30b51cb
      size: 576493
    - path: swisslos_balancing.py
      hash: md5
      md5: 40a10b8b711a046db011b07a41f8608b
      size: 3502
    params:
      params.yaml:
        swisslos_balancing.n_games_threshold: 1000
        swisslos_balancing.random_state: 42
        swisslos_balancing.top_p: 0.2
    outs:
    - path: data/swisslos_balanced.csv
      hash: md5
      md5: a7dacb09206e40d89ae2eb732d26a011
      size: 1014854
  graf_pretrain:
    cmd: python training.py graf
    deps:
    - path: data/graf-dataset-balanced
      hash: md5
      md5: 24b5fcfdba01902faf244dfea654aa63.dir
      size: 219700249
      nfiles: 52
    - path: training.py
      hash: md5
      md5: da49264c2766722337e192abc6cc2de1
      size: 4743
    params:
      params.yaml:
        pre_train.batch_size: 500000
        pre_train.early_stop_patience: 5
        pre_train.hidden_dim: 50
        pre_train.learning_rate: 0.001
        pre_train.max_epochs: 150
        pre_train.n_layers: 3
    outs:
    - path: dvclive/artifacts/trump_selection_pre_trained.ckpt
      hash: md5
      md5: a2143afaea316a967eaba6b0efa01cae
      size: 101040
  swisslos_finetuning:
    cmd: python training.py swisslos dvclive/artifacts/trump_selection_pre_trained.ckpt
    deps:
    - path: data/swisslos_balanced.csv
      hash: md5
      md5: a7dacb09206e40d89ae2eb732d26a011
      size: 1014854
    - path: training.py
      hash: md5
      md5: da49264c2766722337e192abc6cc2de1
      size: 4743
    params:
      params.yaml:
        fine_tune.batch_size: 500000
        fine_tune.early_stop_patience: 100
        fine_tune.learning_rate: 1e-05
        fine_tune.max_epochs: 10000
    outs:
    - path: dvclive/artifacts/trump_selection.ckpt
      hash: md5
      md5: 87aeae736d34c79737cbe01839e9e5b5
      size: 101040
  evaluate_trump_model:
    cmd: python -OO evaluate_trump_model.py
    deps:
    - path: dvclive/artifacts/trump_selection_pre_trained.ckpt
      hash: md5
      md5: 9cf9dbe76bce973ae5eb2e5606971504
      size: 27648
    - path: evaluate_trump_model.py
      hash: md5
      md5: 515a567d749e0174856ef07b5406421f
      size: 1467
    params:
      params.yaml:
        evaluate_trump_model.checkpoint_path: dvclive/artifacts/trump_selection_pre_trained.ckpt
        evaluate_trump_model.n_sets: 128
        evaluate_trump_model.num_workers: 16
        evaluate_trump_model.points_threshold: 1000
        evaluate_trump_model.time_budget: 0.05
  swisslos_pretrain:
    cmd: python -OO training.py swisslos_full
    deps:
    - path: data/swisslos_balanced_full.csv
      hash: md5
      md5: ba38b26ea051fcc3c48a32c365d1edac
      size: 7841976
    - path: training.py
      hash: md5
      md5: fa680411d92fd5975aabecca672c9880
      size: 4946
    params:
      params.yaml:
        pre_train.batch_size: 500000
        pre_train.early_stop_patience: 20
        pre_train.hidden_dim: 10
        pre_train.learning_rate: 0.0001
        pre_train.max_epochs: 10000
        pre_train.n_layers: 5
    outs:
    - path: dvclive/artifacts/trump_selection_pre_trained.ckpt
      hash: md5
      md5: 9cf9dbe76bce973ae5eb2e5606971504
      size: 27648
